<!DOCTYPE html>
<html lang="en">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RB6N742VZW"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-RB6N742VZW');
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<!-- SEO META TAGS -->
<title>Filming Map | ShowcasingOz TV â€“ Discover Our Australian Travel Itinerary</title>
<meta name="description" content="Explore the ShowcasingOz TV filming map to see each Australian town we visit and film. Discover dates, our 2026 travel route across Australia." />
<meta name="keywords" content="ShowcasingOz TV, filming map, Australian travel series, travel itinerary, TV filming locations, Australia travel, regional tourism" />

<meta property="og:title" content="ShowcasingOz TV Filming Map" />
<meta property="og:description" content="Interactive filming map showing each town visited by ShowcasingOz TV during our 2026 travel series." />
<meta property="og:image" content="https://showcasingoztv.com.au/images/og-image-map.jpg" />
<meta property="og:url" content="https://showcasingoztv.com.au/filming-map.html" />

<meta name="twitter:card" content="summary_large_image" />
<link rel="canonical" href="https://showcasingoztv.com.au/filming-map.html" />

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" crossorigin="anonymous" />

<!-- Leaflet CSS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// === 1. GOOGLE SHEETS CSV URL ===
const csvUrl =
  "https://docs.google.com/spreadsheets/d/1_wnj3asdBnt5DJph9jXngB-Y2nNxbNO_4IcnfEJgO38/export?format=csv&gid=0";

// === 2. LOAD CSV ===
async function loadCSV() {
  const response = await fetch(csvUrl);
  const text = await response.text();
  return parseCSV(text);
}

// === 3. BASIC CSV PARSER ===
function parseCSV(text) {
  const lines = text.trim().split("\n");
  const header = lines.shift().split(",").map(h => h.trim());

  const dateIndex = header.findIndex(h => h.toLowerCase() === "date");
  const townIndex = header.findIndex(h => h.toLowerCase() === "town");
  const attrIndex = header.findIndex(h => h.toLowerCase().includes("attraction"));

  const entries = lines.map(line => {
    const cols = line.split(",");
    return {
      date: cols[dateIndex]?.trim(),
      town: cols[townIndex]?.trim(),
      attraction: cols[attrIndex]?.trim() || ""
    };
  });

  return entries;
}

// === 4. GROUP INTO DATE RANGES ===
function groupDateRanges(entries) {
  const ranges = [];
  if (entries.length === 0) return ranges;

  let start = entries[0].date;
  let end = entries[0].date;
  let town = entries[0].town;

  for (let i = 1; i < entries.length; i++) {
    const e = entries[i];

    if (e.town === town) {
      end = e.date;
    } else {
      ranges.push({ start, end, town });
      start = e.date;
      end = e.date;
      town = e.town;
    }
  }

  ranges.push({ start, end, town });
  return ranges;
}

// === 5. POPULATE TABLE ===
function populateTable(ranges) {
  const tbody = document.querySelector("#itinerary-table tbody");
  tbody.innerHTML = "";

  ranges.forEach(r => {
    const tr = document.createElement("tr");
    const rangeText = `${r.start} â†’ ${r.end}`;
    tr.innerHTML = `
      <td>${rangeText}</td>
      <td>${r.town}</td>
    `;
    tbody.appendChild(tr);
  });
}

// === 6. GEOCODER ===
// Optional overrides for ambiguous town names (force correct state)
const geocodeOverrides = {
  "hopetoun": "Hopetoun, Victoria, Australia",
  "ivanhoe": "Ivanhoe, New South Wales, Australia",
  "rabbit flat": "Rabbit Flat, Northern Territory, Australia"
};

async function geocodeTown(town) {
  const lower = (town || "").toLowerCase();
  const searchName = geocodeOverrides[lower] || (town + ", Australia");

  const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchName)}`;
  try {
    const response = await fetch(url);
    const json = await response.json();
    if (json.length > 0) {
      return { lat: parseFloat(json[0].lat), lon: parseFloat(json[0].lon) };
    }
  } catch (e) { console.error("Geocoding error:", e); }
  return null;
}

// === 7. MAP INITIALISATION ===
const map = L.map("map").setView([-25.0, 133.0], 5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

// === 8. ADD MARKERS + POLYLINE ===
async function buildMap(ranges) {
  const points = [];
  for (const r of ranges) {
    const coords = await geocodeTown(r.town);
    if (!coords) continue;

    points.push([coords.lat, coords.lon]);

    const popupHtml = `
      <div class="popup-content">
        <strong>${r.town}</strong><br/>
        <span>${r.start} â†’ ${r.end}</span>
      </div>
    `;
    L.marker([coords.lat, coords.lon]).addTo(map).bindPopup(popupHtml);
  }

  if (points.length > 1) {
    const poly = L.polyline(points, { color: "#E87722", weight: 4 }).addTo(map);
    map.fitBounds(poly.getBounds(), { padding: [40, 40] });
  }
}

// === 9. MASTER FUNCTION ===
async function init() {
  try {
    const raw = await loadCSV();
    document.getElementById("status").innerText = "Building itinerary...";

    // Sort by date
    const sorted = raw.sort((a, b) =>
      new Date(a.date.split("/").reverse().join("-")) -
      new Date(b.date.split("/").reverse().join("-"))
    );

    // === HIDE NON-FILMING ENTRIES & BLANKS ===
    const filtered = sorted.filter(entry => {
      // Skip any blank or malformed rows
      if (!entry.date || !entry.date.trim() || !entry.town || !entry.town.trim()) {
        return false;
      }

      const town = entry.town.toLowerCase();

      // Hide ONLY the pre-filming Coober Pedy date (30/05/2026)
      if (town === "coober pedy" && entry.date === "30/05/2026") {
        return false;
      }

      // Pre-filming travel (Tassie â†’ Adelaide leg)
      if (["hobart", "spirit of tasmania", "mt gambier", "adelaide"].includes(town))
        return false;

      // Hide annual leave
      if (town.includes("annual leave")) return false;

      // Hide 26 Sep â†’ 05 Oct pause
      const d = new Date(entry.date.split("/").reverse().join("-"));
      const pauseStart = new Date("2026-09-26");
      const pauseEnd = new Date("2026-10-05");
      if (d >= pauseStart && d <= pauseEnd) return false;

      return true;
    });

    const ranges = groupDateRanges(filtered);
    populateTable(ranges);
    buildMap(ranges);

    document.getElementById("status").innerText = "Itinerary loaded successfully.";
  } catch (e) {
    console.error(e);
    document.getElementById("status").innerText = "Error loading itinerary from Google Sheets.";
  }
}

init();
</script>

<!-- ===================== -->
<!-- PART 3 â€” FOOTER + CLOSING TAGS -->
<!-- ===================== -->

</div> <!-- end .container -->

  <!-- FOOTER -->
<footer>
  <div class="container">
    <div class="footer-links">
      <a href="../index.html">Home</a> |
      <a href="../about.html">About Us</a> |
      <a href="../towns/index.html">Towns</a> |
      <a href="../partner.html">Partner With Us</a> |
      <a href="../sponsorship.html">Sponsorship</a> |
      <a href="../filming-map.html">Filming Map</a> |
      <a href="../press.html">Press</a> |
      <a href="../contact.html">Contact</a> |
      <a href="../legal.html">Legal</a>
    </div>

    <p style="margin-top:10px;">
      ðŸ“§ <a href="mailto:showcasingoztv@gmail.com">showcasingoztv@gmail.com</a><br>
      Â© 2026 ShowcasingOz TV Â· Discover. Capture. Share.
    </p>
  </div>
</footer>


</body>
</html>
